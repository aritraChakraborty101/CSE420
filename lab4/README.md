# Lab 4: Intermediate Code Generation - Three-Address Code

## Overview
This lab implements intermediate code generation for a C language subset compiler. The implementation builds an Abstract Syntax Tree (AST) during parsing and then traverses it to generate three-address code.

## Implementation Summary

### 1. Abstract Syntax Tree (AST) - `ast.h`
Implemented a complete AST with the following node types:

#### Expression Nodes (ExprNode)
- **VarNode**: Variable references and array access
- **ConstNode**: Integer and float constants
- **BinaryOpNode**: Binary operations (+, -, *, /, <, >, ==, !=, <=, >=, &&, ||)
- **UnaryOpNode**: Unary operations (-, !)
- **AssignNode**: Assignment operations
- **FuncCallNode**: Function calls with arguments

#### Statement Nodes (StmtNode)
- **ExprStmtNode**: Expression statements
- **BlockNode**: Compound statements (blocks)
- **IfNode**: If-else statements
- **WhileNode**: While loops
- **ForNode**: For loops
- **ReturnNode**: Return statements
- **DeclNode**: Variable declarations

#### Program Structure
- **FuncDeclNode**: Function definitions
- **ProgramNode**: Root node representing entire program

### 2. AST Construction - `syntax_analyzer.y`
Modified the parser to build AST nodes while parsing:
- Each grammar rule creates appropriate AST nodes
- Nodes are connected to form a tree structure
- AST nodes are stored in symbol_info objects via `set_ast_node()`

### 3. Three-Address Code Generation
Each AST node implements a `generate_code()` method that:
- Generates appropriate three-address code instructions
- Manages temporary variables (t0, t1, t2, ...)
- Manages labels for control flow (L0, L1, L2, ...)
- Implements temp reuse optimization within function scopes

#### Key Features:
1. **Temp Management**: 
   - Each variable read loads into a temp
   - Temps are cached and reused within function scope
   - Assignments update the temp cache

2. **Control Flow**:
   - If-else: Uses conditional jumps and labels
   - While: Loop start/end labels with conditional jumps
   - For: Init, condition check, body, update with proper labels

3. **Function Scoping**:
   - Each function has its own temp symbol table
   - Prevents temp variable conflicts between functions

4. **Operations**:
   - Arithmetic: `t2 = t0 + t1`
   - Relational: `t3 = t1 < t2`
   - Logical: `t4 = t2 && t3`
   - Function calls: `param t1; t5 = call func, 2`
   - Array access: `t6 = arr[t5]`

### 4. Code Generator - `three_addr_code.h`
The `ThreeAddrCodeGenerator` class:
- Takes the AST root and output stream
- Generates formatted three-address code with headers and footers
- Manages global temp and label counters

## Output Format
```
//========== THREE ADDRESS CODE ==========

// This code was generated by a two-pass compiler
// Format: 
// - t0, t1, etc. are temporary variables
// - L0, L1, etc. are labels for jumps
// - Operations follow the three-address code format

// Three Address Code

// Function: int func(int a, int b)
t0 = a
t1 = b
t2 = t0 + t1
return t2

//========== END OF CODE ==========
```

## Usage
```bash
bash script.sh
```

The script will:
1. Compile the lexer and parser
2. Run the two-pass compiler on input3.c
3. Generate log.txt, error.txt, and code.txt

## Testing
Tested with provided sample inputs:
- `input1.c`: Basic function calls and declarations
- `input2.c`: Control structures (for, if, while)
- `input3.c`: Nested if statements

All test cases produce correct three-address code.

## Implementation Notes

### Optimizations
The implementation includes temp reuse optimization:
- Variables that are assigned to temps keep their temp association
- Subsequent reads of the same variable reuse the temp (unless reassigned)
- This reduces the number of temps needed

### Memory Management
- Proper destructors ensure no memory leaks
- AST nodes own their children and delete them
- Special care taken for INCOP/DECOP to avoid double-free

### Edge Cases Handled
- Empty blocks
- Null expressions in for loops
- Function calls with no arguments
- Nested control structures
- Variable shadowing in nested scopes

## Files Modified/Created
1. **ast.h**: Complete AST implementation with code generation
2. **three_addr_code.h**: Code generator implementation
3. **syntax_analyzer.y**: Parser modifications to build AST
4. **symbol_info.h**: Added AST node storage (pre-existing)

## Authors
Implementation completed for CSE420 Compiler Design Lab 4
